<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>实时位置展示</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 500px; }
  </style>
</head>
<body>
  <h1>实时位置展示</h1>
  <div id="map"></div>

  <!-- Leaflet JS （CDN） -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script type="module">
    // 1. 导入所需的 Firebase 功能
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

    // 2. 你的 Firebase 配置
    const firebaseConfig = {
      apiKey: "AIzaSyA5fHJfmU2BnD9mvKDPzvlycQD_lRx03K8",
      authDomain: "gpslulutech.firebaseapp.com",
      databaseURL: "https://gpslulutech-default-rtdb.firebaseio.com",
      projectId: "gpslulutech",
      storageBucket: "gpslulutech.firebasestorage.app",
      messagingSenderId: "1048536840121",
      appId: "1:1048536840121:web:0817ac28a529c1bbb3a868",
      measurementId: "G-JBXX10NY6R"
    };

    // 3. 初始化 Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // 4. 获取 Realtime Database 引用
    const db = getDatabase(app);

    // 5. 初始化 Leaflet 地图
    const map = L.map('map').setView([0, 0], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    // 6. 在地图上放置一个标记
    const marker = L.marker([0, 0]).addTo(map);

    // 7. 监听数据库中位置的变化，并更新标记与视图
    onValue(ref(db, 'location/your_device_id'), (snapshot) => {
      const data = snapshot.val();
      if (data) {
        const { lat, lng } = data;
        marker.setLatLng([lat, lng]);
        map.setView([lat, lng], 13);
      }
    });
  </script>
</body>
</html>
